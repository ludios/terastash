set -e

rm -rf node_modules || true
./dev/npm install
./dev/npm dedupe
# Unneeded files
rm -f node_modules/bluebird/js/browser/bluebird.min.js
rm -f node_modules/cassandra-driver/node_modules/long/dist/Long.min.js
rm -f node_modules/cassandra-driver/node_modules/long/dist/Long.min.js.gz
rm -f node_modules/cassandra-driver/node_modules/long/dist/Long.min.map
# Re-patch node_modules/
for patchfile in ./dev/patches/???-*.patch; do
	echo -E "Applying $patchfile"
	patch -p1 < "$patchfile"
done
